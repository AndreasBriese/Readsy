<!DOCTYPE html>
<html>

<head>
	<link rel="stylesheet" type="text/css" href="../static/css/all.css">
	<title>Upload File to Readsy</title>
	
	<script type="text/javascript" src="../static/js/lodash.compat.min.js"></script>
	<script type="text/javascript" src="../static/js/s3upload.js"></script>

	<script type="text/javascript">
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-50152323-1', 'readsy.co');
	  ga('send', 'pageview');
	</script>
</head>

<body>
	<div class="outer">
	<div class="middle">
	<div class="inner">

	<center>
		<h1>Upload File to Readsy</h1>

		<!-- <p id="status">Please select a file for S3 storage</p>
		<input type="file" id="files"/> -->

		<p>Please select file to readsy!</p>
		<form action="" method="post" enctype="multipart/form-data">
		  <p>
		  	<input type="file" name="file" id="files2"/>
		    <input type="submit" value="Upload + Go!">
		 </p>	
		</form>
	</center>

	</div>
	</div>
	</div>
	<script>
		function s3_upload(){
		    var s3upload = new S3Upload({
		        file_dom_selector: '#files',
		        s3_sign_put_url: '/sign_s3/',
		        onProgress: function(percent, message) {
		            $('#status').html('Upload progress: ' + percent + '% ' + message);
		        },
		        onFinishS3Put: function(public_url) {
		            $('#status').html('Upload completed!');
		            var s = $('input[type=file]').val().split('\\').pop();

		            url = "\/spritzy\/" + s;
		            console.log(url);
		            location.assign(url);
		            // Uploaded to: '+ public_url);
		            // $("#avatar_url").val(public_url);
		            // $("#preview").html('<img src="'+public_url+'" style="width:300px;" />');
		        },
		        onError: function(status) {
		            $('#status').html('Upload error: ' + status);
		        }
		    });
		}

		$().ready(function() {
		    $('#files').on("change", s3_upload);
		});
	</script>
	<script type="text/javascript" src="../static/js/jquery-1.11.0.min.js"></script>
</body>

</html>